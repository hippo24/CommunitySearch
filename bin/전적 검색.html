<!DOCTYPE html>
<html>
  <head>
    <title>Riot API Ï†ÑÏ†Å Ï°∞Ìöå</title>
  </head>
  <body>
    <input type="text" id="riotId" placeholder="Riot ID (Ïòà: ÏïÑÏù¥Îîî#ÌÉúÍ∑∏)" />
    <button onclick="getMatchHistory()">ÏµúÍ∑º Ï†ÑÏ†Å Ï°∞Ìöå</button>
    <pre id="output"></pre>

    <script>
      async function getMatchHistory() {
        const input = document.getElementById("riotId").value;
        const [gameName, tagLine] = input.split("#");
        const apiKey = "RGAPI-dd357dd3-702e-4d21-bc26-717827a494e8"; // api

        if (!gameName || !tagLine) {
          document.getElementById("output").textContent =
            "ÌòïÏãùÏù¥ ÏûòÎ™ªÎêòÏóàÏäµÎãàÎã§. Ïòà: GO FARM#POS4";
          return;
        }

        try {
          // 1Îã®Í≥Ñ: Riot ID ‚Üí puuid
          const accountRes = await fetch(
            `https://asia.api.riotgames.com/riot/account/v1/accounts/by-riot-id/${encodeURIComponent(
              gameName
            )}/${encodeURIComponent(tagLine)}`,
            {
              headers: { "X-Riot-Token": apiKey },
            }
          );
          const accountData = await accountRes.json();
          const puuid = accountData.puuid;
          const riotName = accountData.gameName;

          // 2. ÏÜåÌôòÏÇ¨ Ï†ïÎ≥¥Î°ú Î†àÎ≤®, summonerId Í∞ÄÏ†∏Ïò§Í∏∞
          const summonerRes = await fetch(
            `https://kr.api.riotgames.com/lol/summoner/v4/summoners/by-puuid/${puuid}`,
            {
              headers: { "X-Riot-Token": apiKey },
            }
          );
          const summonerData = await summonerRes.json();
          const { summonerLevel, id: summonerId } = summonerData;
          const name = riotName; // nameÏù¥ ÏóÜÎã§Î©¥ riotNameÏùÑ ÎåÄÏ≤¥ ÏÇ¨Ïö©,
          // ÏûÖÎ†•Í∞íÏùÑ Í∑∏ÎåÄÎ°ú Î∞õÏïÑÏò§Î©¥ Ïïà ÎêòÎäî Ïù¥Ïú† => ÏûÖÎ†•Îïå abcabc#kr1Î°ú Í≤ÄÏÉâÏùÑ ÌñàÏúºÎ©¥ Ïã§Ï†ú ÎãâÎÑ§ÏûÑÏùÄ abc abc#krÏù∏Îç∞ ÎåÄÏÜåÎ¨∏Ïûê/ÎùÑÏñ¥Ïì∞Í∏∞Î•º Î¨¥ÏãúÌïòÎäî ÏÉÅÌô©Ïù¥ Î∞úÏÉù

          // 2. Ìã∞Ïñ¥ / Ï†êÏàò / ÏäπÌå®
          const leagueRes = await fetch(
            `https://kr.api.riotgames.com/lol/league/v4/entries/by-summoner/${summonerId}`,
            {
              headers: { "X-Riot-Token": apiKey },
            }
          );
          const leagueData = await leagueRes.json();
          const soloQ = leagueData.find(
            (entry) => entry.queueType === "RANKED_SOLO_5x5"
          );

          let tierInfo = {};
          if (soloQ) {
            const { tier, rank, leaguePoints, wins, losses } = soloQ;
            const winRate = ((wins / (wins + losses)) * 100).toFixed(1);
            tierInfo = {
              tier,
              rank,
              leaguePoints,
              wins,
              losses,
              winRate: winRate + "%",
            };
          }

          // 2Îã®Í≥Ñ: puuid ‚Üí matchId Î™©Î°ù
          const matchIdsRes = await fetch(
            `https://asia.api.riotgames.com/lol/match/v5/matches/by-puuid/${puuid}/ids?start=0&count=30`, //count=""ÏïàÏóê Ïà´Ïûê Î∞îÍæ∏Î©¥ Ï∂úÎ†• Í∞ØÏàòÏôÄ ÌÜµÍ≥ÑÍ∞Ä Î∞îÎÄú
            {
              headers: { "X-Riot-Token": apiKey },
            }
          );
          const matchIds = await matchIdsRes.json();

          // 3Îã®Í≥Ñ: Í∞Å matchId ‚Üí ÏÉÅÏÑ∏ Ï†ïÎ≥¥ Í∞ÄÏ†∏Ïò§Í∏∞
          const matchDetails = [];
          for (let matchId of matchIds) {
            const matchRes = await fetch(
              `https://asia.api.riotgames.com/lol/match/v5/matches/${matchId}`,
              {
                headers: { "X-Riot-Token": apiKey },
              }
            );
            const matchData = await matchRes.json();

            // ÎÇ¥Í∞Ä ÌîåÎ†àÏù¥Ìïú Îç∞Ïù¥ÌÑ∞Îßå Ï∂îÏ∂ú
            const myData = matchData.info.participants.find(
              (p) => p.puuid === puuid
            );

            matchDetails.push({
              matchId,
              championName: myData.championName,
              kills: myData.kills,
              deaths: myData.deaths,
              assists: myData.assists,
              win: myData.win,
              gameDuration: matchData.info.gameDuration,
            });
          }
          // ÏòàÏãú Î°úÏßÅ
          const stats = {};
          for (let game of matchDetails) {
            const champ = game.championName;
            if (!stats[champ]) stats[champ] = { games: 0, wins: 0 };
            stats[champ].games += 1;
            if (game.win) stats[champ].wins += 1;
          }
          // ÏäπÎ•† Í≥ÑÏÇ∞ Ï∂îÍ∞Ä
          Object.entries(stats).forEach(([champ, data]) => {
            data.winRate = ((data.wins / data.games) * 100).toFixed(1) + "%";
          });

          // ÏÉÅÏúÑ 3Í∞ú Ï±îÌîºÏñ∏ ÌÜµÍ≥Ñ Ï∂îÏ∂ú (games Í∏∞Ï§Ä ÎÇ¥Î¶ºÏ∞®Ïàú)
          const sortedStats = Object.entries(stats)
            .map(([champion, data]) => ({ champion, ...data }))
            .sort((a, b) => b.games - a.games)
            .slice(0, 3);

          // Í≤∞Í≥º Ï∂úÎ†•
          document.getElementById("output").textContent =
            `üîç ÏÜåÌôòÏÇ¨ Ï†ïÎ≥¥\n` +
            `ÎãâÎÑ§ÏûÑ: ${name}\nÎ†àÎ≤®: ${summonerLevel}\n` +
            (tierInfo.tier
              ? `Ìã∞Ïñ¥: ${tierInfo.tier} ${tierInfo.rank} (${tierInfo.leaguePoints}LP)\n` +
                `Ïäπ/Ìå®: ${tierInfo.wins}Ïäπ ${tierInfo.losses}Ìå®\n` +
                `ÏäπÎ•†: ${tierInfo.winRate}\n`
              : "Îû≠ÌÅ¨ Ï†ïÎ≥¥ ÏóÜÏùå\n") +
            `\nüî• Ï±îÌîºÏñ∏Î≥Ñ ÌÜµÍ≥Ñ (ÏµúÍ∑º ${matchIds.length}Ìåê Í∏∞Ï§Ä)\n` +
            JSON.stringify(sortedStats, null, 2) +
            `\n\nüìò ÏµúÍ∑º Í≤ΩÍ∏∞ Ï†ÑÏ†Å\n` +
            JSON.stringify(matchDetails, null, 2);
        } catch (err) {
          document.getElementById("output").textContent =
            "Ï†ÑÏ†ÅÏùÑ Î∂àÎü¨Ïò§Îäî Ï§ë Ïò§Î•ò Î∞úÏÉù.";
          console.error(err);
        }
      }
      //ÏóîÌÑ∞Î°ú Í≤ÄÏÉâ Í∞ÄÎä•
      document.addEventListener("DOMContentLoaded", () => {
        const input = document.getElementById("riotId");

        input.addEventListener("keydown", (event) => {
          if (event.key === "Enter") {
            getMatchHistory();
          }
        });
      });
    </script>
  </body>
</html>
